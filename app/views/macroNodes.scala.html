@import net.wa9nnn.rc210.data.functions.FunctionsProvider
@import net.wa9nnn.rc210.data.macros.MacroNode
@import net.wa9nnn.rc210.data.named.NamedSource
@import net.wa9nnn.rc210.key.KeyKind
@import views.html.helper._
@import net.wa9nnn.rc210.key.KeyFactory.MacroKey
@import net.wa9nnn.rc210.ui.Tabs
@(macroNodes: Seq[MacroNode])(implicit functionsProvider: FunctionsProvider)

@tabbedmain(Tabs.macrosTab) {
    <div class="container">
    @form(action = routes.MacroNodeController.save()) {
        <table class="table table-bordered w-auto">
            <thead class="table-primary">
                <tr>
                    <td>&nbsp;</td>
                    <td title="Number or name">Macro</td>
                    <td title="DTMF that will invoke this macro">DTMF</td>
                    <td>Function</td>
                </tr>
            </thead>
        @for(macroNode <- macroNodes) {
            <tr>
                <td>
                    <button type="button" class="bi bi-pencil-square btn p-0"
                    onclick="window.location.href='@routes.MacroNodeController.edit(macroNode.key.asInstanceOf[MacroKey])'"></button>
                </td>
                <td title="@macroNode.key.toString">
                @Html( macroNode.key.namedHtml)
                </td>
                <td class="text-end">
                    @macroNode.dtmf
                </td>
                <td>
                    <table class="table table-bordered table-sm w-auto" >
                    @for(functionKey <- macroNode.functions) {
                        <tr>
                            <td class="text-end">@functionKey.number</td>
                            <td>@functionsProvider(functionKey).map(_.description).getOrElse("???")</td>
                        </tr>
                    }
                    </table>
                </td>
            </tr>
        }
        </table>
    }
    </div>
}